<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" data-theme="auto" data-bs-theme="auto">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Le dice al navegador que soportas ambos esquemas -->
  <meta name="color-scheme" content="light dark">

  <title>Iniciar sesión · DRosasAguilarDamian</title>

  <!-- ====== INIT DEL TEMA (ANTES de CSS para evitar flash) ====== -->
  <script>
    (function () {
      var KEY = 'theme-preference';
      var root = document.documentElement;

      function prefersDark() {
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      }
      function resolved(mode) {
        return mode === 'auto' ? (prefersDark() ? 'dark' : 'light') : mode;
      }
      function apply(mode) {
        root.setAttribute('data-theme', mode);                  // auto | light | dark (tuyo)
        root.setAttribute('data-bs-theme', resolved(mode));     // light | dark (Bootstrap)
      }

      var saved = localStorage.getItem(KEY) || 'auto';
      apply(saved);

      // Reacciona a cambios del sistema cuando estás en 'auto'
      if (saved === 'auto' && window.matchMedia) {
        var mql = window.matchMedia('(prefers-color-scheme: dark)');
        if (mql.addEventListener) {
          mql.addEventListener('change', function(){ apply('auto'); });
        } else if (mql.addListener) {
          mql.addListener(function(){ apply('auto'); });
        }
      }

      // Exponer mini API por si quieres cambiar con un botón
      window.__theme = {
        get: function(){ return localStorage.getItem(KEY) || 'auto'; },
        set: function(mode){ localStorage.setItem(KEY, mode); apply(mode); }
      };
    })();
  </script>

  <!-- Bootstrap + Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --card-br: 18px;
      --card-blur: 10px;
      --shadow: 0 10px 40px rgba(0,0,0,.15);
      --brand:#6c5ce7;
      --brand-2:#00d2d3;
      --text-muted: #6c757d;
    }

    /* ====== THEMING por data-bs-theme ====== */
    /* Light */
    html[data-bs-theme="light"] body{
      background: radial-gradient(1200px 600px at -10% -10%, #6c5ce733 0%, transparent 60%),
                  radial-gradient(1000px 500px at 110% 110%, #00d2d333 0%, transparent 60%),
                  linear-gradient(135deg, #f8f9fa, #eef2ff);
    }
    html[data-bs-theme="light"] .glass-card{
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(0,0,0,.06);
      box-shadow: var(--shadow);
    }
    html[data-bs-theme="light"] .brand-sub{ color:#6c757d; }
    html[data-bs-theme="light"] .form-floating .form-control{
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(0,0,0,.08);
      color:#212529;
    }

    /* Dark */
    html[data-bs-theme="dark"] body{
      background: radial-gradient(1200px 600px at -10% -10%, #6c5ce722 0%, transparent 60%),
                  radial-gradient(1000px 500px at 110% 110%, #00d2d322 0%, transparent 60%),
                  linear-gradient(135deg, #0b0e14, #131826);
    }
    html[data-bs-theme="dark"] .glass-card{
      background: rgba(32,32,38,.60);
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
    }
    html[data-bs-theme="dark"] .brand-sub{ color:#adb5bd; }
    html[data-bs-theme="dark"] .form-floating .form-control{
      background: rgba(0,0,0,.20);
      border: 1px solid rgba(255,255,255,.12);
      color:#e9ecef;
    }

    body{min-height:100vh;}
    .login-wrap{
      min-height:100vh; display:grid; place-items:center; padding:24px;
    }
    .glass-card{
      border-radius: var(--card-br);
      backdrop-filter: blur(var(--card-blur));
      -webkit-backdrop-filter: blur(var(--card-blur));
      overflow: hidden;
    }

    .brand-badge{
      width:64px; height:64px; border-radius:16px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      color:#fff; font-size:1.5rem; font-weight:700;
      box-shadow: 0 8px 24px rgba(108,92,231,.35);
    }
    .btn-gradient{
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      color:#fff; border:0; box-shadow: 0 8px 20px rgba(108,92,231,.35);
    }
    .btn-gradient:hover{ filter: brightness(1.05); color:#fff; }
    .password-toggle{
      position:absolute; right:.75rem; top:50%; transform:translateY(-50%);
      border:0; background:transparent; padding:.25rem; line-height:1; opacity:.8;
    }
    .password-toggle:hover{ opacity:1; }
    .caps-hint{ display:none; font-size:.85rem; }
    .theme-toggle{
      position: fixed; right: 12px; top: 12px; z-index: 10;
    }
    .footer-tip{ font-size:.85rem; opacity:.85; }
  </style>
</head>
<body>

<!-- Toggle opcional (Auto/Light/Dark) para pruebas -->
<div class="theme-toggle btn-group btn-group-sm" role="group" aria-label="Cambiar tema">
  <button type="button" class="btn btn-outline-secondary" onclick="__theme.set('auto')">Auto</button>
  <button type="button" class="btn btn-outline-secondary" onclick="__theme.set('light')">Light</button>
  <button type="button" class="btn btn-outline-secondary" onclick="__theme.set('dark')">Dark</button>
</div>

<main class="login-wrap">
  <div class="glass-card" style="max-width: 420px; width:100%;">
    <div class="p-4 p-md-5">
      <!-- Brand -->
      <div class="d-flex align-items-center gap-3 mb-3">
        <div class="brand-badge">
          <i class="bi bi-shield-lock"></i>
        </div>
        <div>
          <div class="h4 mb-0 fw-bold">Inicio de sesion</div>
          <div class="brand-sub">Accede a tu panel administrativo</div>
        </div>
      </div>

      <!-- Estados -->
      <div th:if="${param.error}" class="alert alert-danger py-2 px-3 mb-3">
        <i class="bi bi-exclamation-triangle-fill me-1"></i> Usuario o contraseña inválidos.
      </div>
      <div th:if="${param.logout}" class="alert alert-success py-2 px-3 mb-3">
        <i class="bi bi-check-circle-fill me-1"></i> Has cerrado sesión correctamente.
      </div>

      <!-- Form -->
      <form th:action="@{/usuario/login}" method="post" class="needs-validation" novalidate>
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

        <div class="form-floating mb-3">
          <input type="text" class="form-control" id="username" name="username"
       placeholder="Usuario" required autofocus
       autocomplete="username" inputmode="text" />
          <label for="username"><i class="bi bi-person me-1"></i> Usuario</label>
          <div class="invalid-feedback">Ingresa tu usuario.</div>
        </div>

        <div class="form-floating mb-2 position-relative">
          <input type="password" class="form-control" id="password" name="password"
       placeholder="Contraseña" required autocomplete="current-password" />
          <label for="password"><i class="bi bi-key me-1"></i> Contraseña</label>
          <button type="button" class="password-toggle" tabindex="-1" aria-label="Mostrar u ocultar contraseña">
            <i class="bi bi-eye-slash" id="pwIcon"></i>
          </button>
          <div class="invalid-feedback">Ingresa tu contraseña.</div>
        </div>

        <!-- Caps Lock -->
        <div id="capsHint" class="caps-hint text-warning mb-3">
          <i class="bi bi-exclamation-diamond-fill me-1"></i> Tienes activado <strong>Caps Lock</strong>.
        </div>

        <button class="btn btn-gradient w-100 py-2" type="submit">
          <i class="bi bi-box-arrow-in-right me-1"></i> Entrar
        </button>
      </form>

      <div class="mt-3 text-center footer-tip">
        Tip de prueba: <strong>admin / test123</strong>
      </div>
    </div>

   
  </div>
</main>

<!-- Scripts -->
<script>
  // Validación Bootstrap
  (function () {
    'use strict';
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', function (e) {
        if (!form.checkValidity()) { e.preventDefault(); e.stopPropagation(); }
        form.classList.add('was-validated');
      }, false);
    });
  })();

  // Mostrar/ocultar contraseña
  (function () {
    const pw = document.getElementById('password');
    const btn = document.querySelector('.password-toggle');
    const icon = document.getElementById('pwIcon');
    if (btn && pw && icon) {
      btn.addEventListener('click', () => {
        const isPass = pw.getAttribute('type') === 'password';
        pw.setAttribute('type', isPass ? 'text' : 'password');
        icon.className = isPass ? 'bi bi-eye' : 'bi bi-eye-slash';
      });
    }
  })();

  // Aviso Caps Lock
  (function () {
    const pw = document.getElementById('password');
    const hint = document.getElementById('capsHint');
    if (!pw || !hint) return;
    function onEvent(e){
      const caps = e.getModifierState && e.getModifierState('CapsLock');
      hint.style.display = caps ? 'block' : 'none';
    }
    pw.addEventListener('keydown', onEvent);
    pw.addEventListener('keyup', onEvent);
  })();
</script>
</body>
</html>
